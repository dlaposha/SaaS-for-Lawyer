[celery]
# Основні налаштування
app = src.celery:celery_app
broker = redis://:redis_password_change_this@redis:6379/1
result_backend = redis://:redis_password_change_this@redis:6379/2

# Налаштування worker
concurrency = 4
prefetch_multiplier = 4
task_acks_late = True
worker_max_tasks_per_child = 1000
worker_disable_rate_limits = False

# Налаштування серіалізації
task_serializer = json
result_serializer = json
accept_content = [json]

# Налаштування часового поясу
timezone = Europe/Kiev
enable_utc = False

# Налаштування планувальника
beat_schedule_filename = /var/run/celery/celerybeat-schedule
beat_scheduler = celery.beat.PersistentScheduler

# Налаштування логування
logfile = /var/log/celery/worker.log
loglevel = INFO

# Налаштування моніторингу
worker_send_task_events = True
task_send_sent_event = True

# Налаштування ретрі
task_default_retry_delay = 180
task_max_retries = 3

# Налаштування безпеки
worker_redirect_stdouts = True
worker_hijack_root_logger = False

# Черги
task_default_queue = default
task_routes = {
    'src.celery.tasks.send_email': {'queue': 'emails'},
    'src.celery.tasks.generate_report': {'queue': 'reports'},
    'src.celery.tasks.backup_database': {'queue': 'maintenance'},
}

[beat]
# Розклад завдань
schedule = {
    'cleanup-sessions': {
        'task': 'src.celery.tasks.cleanup_old_sessions',
        'schedule': 86400.0,  # Щодня
    },
    'send-daily-reports': {
        'task': 'src.celery.tasks.send_daily_reports',
        'schedule': 3600.0,  # Кожну годину
    },
}